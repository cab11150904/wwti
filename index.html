<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wanna Watch Something</title>
    <style>
        :root {
            --primary-color: #032541;
            --secondary-color: #01b4e4;
            --background-color: #f5f5f5;
            --card-background: #ffffff;
            --text-color: #333333;
            --card-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--background-color);
            color: var(--text-color);
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background-color: var(--primary-color);
            color: white;
            padding: 20px 0;
            text-align: center;
            margin-bottom: 30px;
        }
        
        h1 {
            margin: 0;
            font-size: 2.5rem;
        }
        
        .search-container {
            display: flex;
            justify-content: center;
            margin-bottom: 30px;
        }
        
        .search-box {
            display: flex;
            width: 100%;
            max-width: 600px;
        }
        
        #content-search {
            flex-grow: 1;
            padding: 12px 16px;
            font-size: 1rem;
            border: 1px solid #ddd;
            border-radius: 4px 0 0 4px;
            outline: none;
        }
        
        button {
            background-color: var(--secondary-color);
            color: white;
            border: none;
            padding: 12px 24px;
            font-size: 1rem;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        .search-button {
            border-radius: 0 4px 4px 0;
        }
        
        button:hover {
            background-color: #018eb6;
        }
        
        #search-results, #related-content {
            margin-bottom: 30px;
        }
        
        .content-results, .related-results {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            gap: 15px;
            max-height: calc(100vh - 350px);
            overflow-y: auto;
            padding-right: 10px;
        }
        
        .related-results {
            max-height: calc(100vh - 350px);
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            gap: 15px;
        }
        
        .section-divider {
            border-top: 1px solid #ddd;
            margin: 40px 0 20px;
        }
        
        .content-card {
            background-color: var(--card-background);
            border-radius: 8px;
            overflow: hidden;
            box-shadow: var(--card-shadow);
            transition: transform 0.3s;
            cursor: pointer;
            width: calc(33.333% - 10px);
            margin-bottom: 15px;
            position: relative;
        }
        
        .content-card:hover {
            transform: translateY(-5px);
        }
        
        .content-poster {
            width: 100%;
            height: 300px;
            object-fit: cover;
            background-color: #ddd;
        }
        
        .content-info {
            padding: 15px;
        }
        
        .content-title {
            font-weight: bold;
            margin-bottom: 5px;
            font-size: 1rem;
        }
        
        .content-year {
            color: #666;
            font-size: 0.9rem;
        }
        
        .content-type {
            display: inline-block;
            padding: 2px 6px;
            margin-left: 5px;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: normal;
            color: white;
        }
        
        .type-movie {
            background-color: #ED4956;
        }
        
        .type-tv {
            background-color: #4267B2;
        }
        
        #cast-container {
            display: none;
        }
        
        .content-details {
            display: flex;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .selected-content-poster {
            width: 185px;
            border-radius: 8px;
            box-shadow: var(--card-shadow);
        }
        
        .selected-content-info {
            flex: 1;
        }
        
        .selected-content-title {
            font-size: 1.8rem;
            margin: 0 0 10px 0;
            display: flex;
            align-items: center;
        }
        
        .selected-content-year {
            color: #666;
            font-size: 1.1rem;
            margin-bottom: 15px;
        }
        
        .selected-content-overview {
            line-height: 1.6;
            margin-bottom: 20px;
        }
        
        .watch-providers-container {
            margin-top: 15px;
            background-color: #f8f8f8;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        
        .watch-providers-title {
            font-weight: bold;
            margin-bottom: 10px;
            font-size: 1rem;
            display: flex;
            align-items: center;
        }
        
        .watch-providers-title svg {
            margin-right: 8px;
        }
        
        .watch-providers-list {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 10px;
        }
        
        .provider-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 60px;
            text-decoration: none;
            color: inherit;
            transition: transform 0.2s;
        }
        
        .provider-item:hover {
            transform: translateY(-3px);
        }
        
        .provider-logo {
            width: 50px;
            height: 50px;
            border-radius: 8px;
            object-fit: cover;
            margin-bottom: 5px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        
        .provider-name {
            font-size: 0.7rem;
            text-align: center;
            color: #555;
            word-break: break-word;
            width: 100%;
        }
        
        .provider-type {
            font-weight: bold;
            margin: 10px 0 5px;
            color: #666;
            font-size: 0.9rem;
        }
        
        .region-selector {
            margin-bottom: 10px;
            padding: 5px 10px;
            border-radius: 4px;
            border: 1px solid #ddd;
            background-color: white;
        }
        
        .cast-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
        }
        
        .cast-member {
            background-color: var(--card-background);
            border-radius: 8px;
            overflow: hidden;
            box-shadow: var(--card-shadow);
        }
        
        .cast-header-container {
            display: flex;
            gap: 15px;
            padding: 15px;
        }
        
        .cast-photo {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            object-fit: cover;
            background-color: #ddd;
        }
        
        .cast-info {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        
        .cast-name {
            font-weight: bold;
            font-size: 1.1rem;
            margin-bottom: 5px;
        }
        
        .character-name {
            color: #666;
            font-size: 0.9rem;
        }
        
        .known-for-container {
            padding: 15px;
            border-top: 1px solid #eee;
            background-color: #f9f9f9;
        }
        
        .known-for-title {
            font-weight: bold;
            margin-bottom: 10px;
            font-size: 0.9rem;
        }
        
        .known-for-list {
            display: flex;
            flex-direction: row;
            gap: 10px;
            overflow-x: auto;
            padding-bottom: 10px;
        }
        
        .known-for-item {
            min-width: 120px;
            border-radius: 4px;
            overflow: hidden;
            box-shadow: var(--card-shadow);
            background-color: white;
            text-decoration: none;
            color: var(--text-color);
            display: flex;
            flex-direction: column;
        }
        
        .known-for-poster {
            width: 100%;
            height: 180px;
            object-fit: cover;
            background-color: #ddd;
        }
        
        .known-for-info {
            padding: 8px;
        }
        
        .known-for-name {
            font-size: 0.85rem;
            font-weight: bold;
            margin-bottom: 4px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            display: flex;
            align-items: center;
        }
        
        .known-for-year {
            font-size: 0.75rem;
            color: #666;
            margin-bottom: 2px;
        }
        
        .known-for-role {
            font-size: 0.7rem;
            color: #01b4e4;
            font-style: italic;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .attribution {
            text-align: center;
            margin-top: 50px;
            padding: 20px;
            font-size: 0.85rem;
            color: #666;
        }
        
        .tmdb-logo {
            height: 20px;
            vertical-align: middle;
            margin-left: 5px;
        }
        
        .loader {
            display: none;
            text-align: center;
            margin: 30px 0;
        }
        
        .loader-spinner {
            border: 5px solid #f3f3f3;
            border-top: 5px solid var(--secondary-color);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        @media (max-width: 768px) {
            .content-details {
                flex-direction: column;
                align-items: center;
                text-align: center;
            }
            
            .cast-grid {
                grid-template-columns: repeat(auto-fill, minmax(100%, 1fr));
            }
            
            .content-card {
                width: calc(50% - 10px);
            }
        }
        
        @media (max-width: 480px) {
            .content-card {
                width: 100%;
            }
        }
        
        .placeholder-image {
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: #e1e1e1;
            color: #888;
            font-size: 0.8rem;
            text-align: center;
        }
    </style>
</head>
<body>
    <header>
        <h1>Wanna Watch Something</h1>
    </header>
    
    <div class="container">
        <div class="search-container">
            <div class="search-box">
                <input type="text" id="content-search" placeholder="Search for a movie or TV show...">
                <button class="search-button" id="search-button">Search</button>
            </div>
        </div>
        
        <div id="search-results">
            <h2>Search Results</h2>
            <div class="content-results" id="content-results"></div>
        </div>
        
        <!-- New related content section -->
        <div id="related-content">
            <h2>You Might Also Like</h2>
            <div class="related-results" id="related-results"></div>
        </div>
        
        <div class="loader" id="loader">
            <div class="loader-spinner"></div>
            <p>Loading...</p>
        </div>
        
        <div id="cast-container">
            <div class="content-details" id="content-details"></div>
            <h2>Cast Members</h2>
            <div class="cast-grid" id="cast-grid"></div>
            
            <div id="recommendations-container">
                <h2>You Might Also Like</h2>
                <div class="recommendations-grid" id="recommendations-grid"></div>
            </div>
        </div>
        
        <div class="attribution">
            <!-- TMDB disclaimer removed as requested -->
        </div>
    </div>
    
    <script>
        const API_KEY = 'eyJhbGciOiJIUzI1NiJ9.eyJhdWQiOiI1MjhiYzcxZTI2ODJmYzJmOGI1YjYzNGQ2ZjY3MTYyZSIsIm5iZiI6MTc0MDQ5NjE3My41NTIsInN1YiI6IjY3YmRkZDJkNzYxNzU2OGZjNjVlOWZlNCIsInNjb3BlcyI6WyJhcGlfcmVhZCJdLCJ2ZXJzaW9uIjoxfQ._ZUjD-qC3Duv8FxHAs1Psnzaw_c7e5POR9PhnOo8H8c';
        const BASE_URL = 'https://api.themoviedb.org/3';
        const IMAGE_BASE_URL = 'https://image.tmdb.org/t/p/';
        
        const searchInput = document.getElementById('content-search');
        const searchButton = document.getElementById('search-button');
        const searchResults = document.getElementById('search-results');
        const contentResults = document.getElementById('content-results');
        const castContainer = document.getElementById('cast-container');
        const contentDetails = document.getElementById('content-details');
        const castGrid = document.getElementById('cast-grid');
        const loader = document.getElementById('loader');
        const relatedContent = document.getElementById('related-content');
        const relatedResults = document.getElementById('related-results');
        
        // Hide related content initially
        relatedContent.style.display = 'none';
        
        // Event listeners
        searchButton.addEventListener('click', performSearch);
        searchInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                performSearch();
            }
        });
        
        // Search for movies and TV shows
        async function performSearch() {
            const query = searchInput.value.trim();
            if (!query) return;
            
            console.log(`Performing search for: "${query}"`);
            showLoader();
            
            // Reset the view to search results
            castContainer.style.display = 'none';
            searchResults.style.display = 'block';
            relatedContent.style.display = 'none';
            
            try {
                // Search for movies
                const movieResponse = await fetch(`${BASE_URL}/search/movie?query=${encodeURIComponent(query)}`, {
                    headers: {
                        'Authorization': `Bearer ${API_KEY}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                const movieData = await movieResponse.json();
                console.log('Movie search results:', movieData);
                
                // Also search for TV shows
                const tvResponse = await fetch(`${BASE_URL}/search/tv?query=${encodeURIComponent(query)}`, {
                    headers: {
                        'Authorization': `Bearer ${API_KEY}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                const tvData = await tvResponse.json();
                console.log('TV search results:', tvData);
                
                // Combine and format results
                const combinedResults = [
                    ...movieData.results.map(item => ({...item, media_type: 'movie'})),
                    ...tvData.results.map(item => ({
                        ...item, 
                        media_type: 'tv',
                        title: item.name, // Use 'title' consistently for display
                        release_date: item.first_air_date // Use release_date consistently for display
                    }))
                ];
                
                // Sort by popularity
                combinedResults.sort((a, b) => b.popularity - a.popularity);
                
                displaySearchResults(combinedResults);
                
                // Get trending content instead of trying to fetch recommendations
                getTrendingContent();
            } catch (error) {
                console.error('Error searching for content:', error);
                alert('Failed to search. Please try again.');
            } finally {
                hideLoader();
            }
        }
        
        // Get trending content for recommendations
        async function getTrendingContent() {
            try {
                showLoader();
                
                // Get trending movies and TV shows
                const trendingResponse = await fetch(`${BASE_URL}/trending/all/week`, {
                    headers: {
                        'Authorization': `Bearer ${API_KEY}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                const trendingData = await trendingResponse.json();
                console.log('Trending content:', trendingData);
                
                if (trendingData.results && trendingData.results.length > 0) {
                    // Format trending items for display
                    const formattedItems = trendingData.results.map(item => {
                        if (item.media_type === 'tv') {
                            return {
                                ...item,
                                title: item.name,
                                release_date: item.first_air_date
                            };
                        }
                        return item;
                    });
                    
                    displayRelatedContent(formattedItems);
                } else {
                    relatedContent.style.display = 'none';
                }
            } catch (error) {
                console.error('Error getting trending content:', error);
                relatedContent.style.display = 'none';
            } finally {
                hideLoader();
            }
        }
        
        // Display search results
        function displaySearchResults(items) {
            contentResults.innerHTML = '';
            
            if (items.length === 0) {
                contentResults.innerHTML = '<p>No results found. Try a different search term.</p>';
                return;
            }
            
            // Calculate how many items to display to show 3 in the first row
            const itemsPerRow = window.innerWidth <= 480 ? 1 : (window.innerWidth <= 768 ? 2 : 3);
            
            items.slice(0, 12).forEach(item => {
                const isMovie = item.media_type === 'movie';
                const releaseDate = item.release_date 
                    ? new Date(item.release_date).getFullYear() 
                    : 'Unknown';
                
                const contentCard = document.createElement('div');
                contentCard.className = 'content-card';
                contentCard.addEventListener('click', () => {
                    loadContentCast(item.id, item, isMovie ? 'movie' : 'tv');
                });
                
                let posterHtml;
                if (item.poster_path) {
                    posterHtml = `<img src="${IMAGE_BASE_URL}w342${item.poster_path}" alt="${item.title}" class="content-poster">`;
                } else {
                    posterHtml = `<div class="content-poster placeholder-image">No Poster Available</div>`;
                }
                
                contentCard.innerHTML = `
                    ${posterHtml}
                    <div class="content-info">
                        <div class="content-title">
                            ${item.title}
                            <span class="content-type type-${isMovie ? 'movie' : 'tv'}">${isMovie ? 'Movie' : 'TV'}</span>
                        </div>
                        <div class="content-year">${releaseDate}</div>
                    </div>
                `;
                
                contentResults.appendChild(contentCard);
            });
            
            // Make sure the layout adjusts properly
            window.addEventListener('resize', () => {
                const cards = document.querySelectorAll('.content-card');
                const itemsPerRow = window.innerWidth <= 480 ? 1 : (window.innerWidth <= 768 ? 2 : 3);
                
                cards.forEach((card, index) => {
                    if (index < itemsPerRow) {
                        card.style.marginTop = '0';
                    }
                });
            });
        }
        
        // New function to fetch related content
        async function fetchRelatedContent(contentId, mediaType) {
            console.log(`Fetching related content for ${mediaType} with ID: ${contentId}`);
            
            try {
                // Show loader while fetching
                showLoader();
                
                // Get recommendations for the top result
                const recommendationsEndpoint = mediaType === 'movie' ? 
                    `${BASE_URL}/movie/${contentId}/recommendations` : 
                    `${BASE_URL}/tv/${contentId}/recommendations`;
                
                console.log(`Trying recommendations endpoint: ${recommendationsEndpoint}`);
                
                const recommendationsResponse = await fetch(recommendationsEndpoint, {
                    headers: {
                        'Authorization': `Bearer ${API_KEY}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                const recommendationsData = await recommendationsResponse.json();
                console.log('Recommendations API response:', recommendationsData);
                
                // If no recommendations, try similar content
                if (!recommendationsData.results || recommendationsData.results.length === 0) {
                    console.log('No recommendations found, trying similar content');
                    
                    const similarEndpoint = mediaType === 'movie' ? 
                        `${BASE_URL}/movie/${contentId}/similar` : 
                        `${BASE_URL}/tv/${contentId}/similar`;
                    
                    console.log(`Trying similar endpoint: ${similarEndpoint}`);
                    
                    const similarResponse = await fetch(similarEndpoint, {
                        headers: {
                            'Authorization': `Bearer ${API_KEY}`,
                            'Content-Type': 'application/json'
                        }
                    });
                    
                    const similarData = await similarResponse.json();
                    console.log('Similar API response:', similarData);
                    
                    // Only display if we have results
                    if (similarData.results && similarData.results.length > 0) {
                        displayRelatedContent(similarData.results, mediaType);
                    } else {
                        console.log('No similar content found either');
                        relatedContent.style.display = 'none';
                    }
                } else {
                    console.log(`Found ${recommendationsData.results.length} recommendations`);
                    displayRelatedContent(recommendationsData.results, mediaType);
                }
            } catch (error) {
                console.error(`Error loading related content:`, error);
                relatedContent.style.display = 'none';
            } finally {
                hideLoader();
            }
        }
        
        // Display related content
        function displayRelatedContent(items) {
            console.log('Displaying trending content:', items);
            
            if (!items || items.length === 0) {
                console.log('No trending items to display');
                relatedContent.style.display = 'none';
                return;
            }
            
            relatedResults.innerHTML = '';
            
            // Filter out items with no poster and keep only movies and TV shows
            const filteredItems = items
                .filter(item => item.poster_path && (item.media_type === 'movie' || item.media_type === 'tv'))
                .slice(0, 6); // Limit to 6 items
            
            if (filteredItems.length === 0) {
                console.log('No suitable trending items with posters');
                relatedContent.style.display = 'none';
                return;
            }
            
            console.log('Displaying filtered trending items:', filteredItems);
            
            filteredItems.forEach(item => {
                const isMovie = item.media_type === 'movie';
                const title = item.title || item.name || 'Unknown Title';
                const releaseDate = item.release_date 
                    ? new Date(item.release_date).getFullYear() 
                    : (item.first_air_date ? new Date(item.first_air_date).getFullYear() : 'Unknown');
                
                const contentCard = document.createElement('div');
                contentCard.className = 'content-card';
                contentCard.addEventListener('click', () => {
                    loadContentCast(item.id, item, isMovie ? 'movie' : 'tv');
                });
                
                contentCard.innerHTML = `
                    <img src="${IMAGE_BASE_URL}w342${item.poster_path}" alt="${title}" class="content-poster">
                    <div class="content-info">
                        <div class="content-title">
                            ${title}
                            <span class="content-type type-${isMovie ? 'movie' : 'tv'}">${isMovie ? 'Movie' : 'TV'}</span>
                        </div>
                        <div class="content-year">${releaseDate}</div>
                    </div>
                `;
                
                relatedResults.appendChild(contentCard);
            });
            
            // Show the related content section
            relatedContent.style.display = 'block';
        }
        
        // Load cast for movie or TV show
        async function loadContentCast(contentId, contentData, mediaType) {
            showLoader();
            
            try {
                // Get content credits
                const creditsEndpoint = mediaType === 'movie' ? 
                    `${BASE_URL}/movie/${contentId}/credits` : 
                    `${BASE_URL}/tv/${contentId}/credits`;
                
                const creditsResponse = await fetch(creditsEndpoint, {
                    headers: {
                        'Authorization': `Bearer ${API_KEY}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                const creditsData = await creditsResponse.json();
                
                // Get additional details
                const detailsEndpoint = mediaType === 'movie' ? 
                    `${BASE_URL}/movie/${contentId}` : 
                    `${BASE_URL}/tv/${contentId}`;
                
                const detailsResponse = await fetch(detailsEndpoint, {
                    headers: {
                        'Authorization': `Bearer ${API_KEY}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                const detailsData = await detailsResponse.json();
                
                // Get watch providers
                const providersEndpoint = mediaType === 'movie' ? 
                    `${BASE_URL}/movie/${contentId}/watch/providers` : 
                    `${BASE_URL}/tv/${contentId}/watch/providers`;
                
                const providersResponse = await fetch(providersEndpoint, {
                    headers: {
                        'Authorization': `Bearer ${API_KEY}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                const providersData = await providersResponse.json();
                
                // Normalize data format
                const formattedDetails = mediaType === 'movie' ? 
                    { ...detailsData, mediaType: 'movie', watchProviders: providersData.results } : 
                    { 
                        ...detailsData,
                        mediaType: 'tv',
                        title: detailsData.name,
                        release_date: detailsData.first_air_date,
                        runtime: detailsData.episode_run_time && detailsData.episode_run_time.length > 0 
                            ? detailsData.episode_run_time[0] 
                            : null,
                        watchProviders: providersData.results
                    };
                
                displayContentDetails(formattedDetails);
                displayCastMembers(creditsData.cast);
                
                // Switch to cast view
                searchResults.style.display = 'none';
                relatedContent.style.display = 'none';
                castContainer.style.display = 'block';
                
                // Scroll to top
                window.scrollTo(0, 0);
            } catch (error) {
                console.error(`Error loading ${mediaType} cast:`, error);
                alert(`Failed to load cast information. Please try again.`);
            } finally {
                hideLoader();
            }
        }
        
        // Display content details
        function displayContentDetails(content) {
            const releaseDate = content.release_date ? new Date(content.release_date).getFullYear() : 'Unknown';
            const isMovie = content.mediaType === 'movie';
            
            let runtimeInfo = '';
            if (isMovie && content.runtime) {
                runtimeInfo = `${content.runtime} min`;
            } else if (!isMovie && content.number_of_seasons) {
                runtimeInfo = content.number_of_seasons === 1 ? 
                    '1 Season' : 
                    `${content.number_of_seasons} Seasons`;
            }
            
            let posterHtml;
            if (content.poster_path) {
                posterHtml = `<img src="${IMAGE_BASE_URL}w185${content.poster_path}" alt="${content.title}" class="selected-content-poster">`;
            } else {
                posterHtml = `<div class="selected-content-poster placeholder-image">No Poster Available</div>`;
            }
            
            // Base HTML for content details
            let contentHtml = `
                ${posterHtml}
                <div class="selected-content-info">
                    <h3 class="selected-content-title">
                        ${content.title}
                        <span class="content-type type-${isMovie ? 'movie' : 'tv'}">${isMovie ? 'Movie' : 'TV Show'}</span>
                    </h3>
                    <div class="selected-content-year">${releaseDate}${runtimeInfo ? ' | ' + runtimeInfo : ''}</div>
                    <p class="selected-content-overview">${content.overview || 'No overview available.'}</p>
            `;
            
            // Add watch providers section
            contentHtml += getWatchProvidersHtml(content.watchProviders);
            contentHtml += `</div>`;
            
            contentDetails.innerHTML = contentHtml;
            
            // Set up region selector event if it exists
            const regionSelector = document.getElementById('region-selector');
            if (regionSelector) {
                regionSelector.addEventListener('change', () => {
                    const selectedRegion = regionSelector.value;
                    const watchProvidersContainer = document.getElementById('watch-providers-container');
                    if (watchProvidersContainer) {
                        watchProvidersContainer.innerHTML = getWatchProvidersContentHtml(content.watchProviders, selectedRegion);
                    }
                });
            }
        }
        
        // Generate HTML for watch providers section
        function getWatchProvidersHtml(watchProviders) {
            if (!watchProviders || Object.keys(watchProviders).length === 0) {
                return `
                    <div class="watch-providers-container">
                        <div class="watch-providers-title">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="#01b4e4">
                                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm-1-13h2v6h-2zm0 8h2v2h-2z"/>
                            </svg>
                            Where to Watch
                        </div>
                        <p>No streaming information available for this title.</p>
                    </div>
                `;
            }
            
            // Get available regions
            const regions = Object.keys(watchProviders);
            
            // Default to US if available, otherwise use first available region
            let defaultRegion = regions.includes('US') ? 'US' : regions[0];
            
            // Generate region selector
            let regionSelectorHtml = '';
            if (regions.length > 1) {
                regionSelectorHtml = `
                    <select id="region-selector" class="region-selector">
                        ${regions.map(region => `
                            <option value="${region}" ${region === defaultRegion ? 'selected' : ''}>
                                ${getCountryName(region)}
                            </option>
                        `).join('')}
                    </select>
                `;
            }
            
            return `
                <div class="watch-providers-container">
                    <div class="watch-providers-title">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="#01b4e4">
                            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm-.5-4.5l6-4.5-6-4.5v9z"/>
                        </svg>
                        Where to Watch
                    </div>
                    ${regionSelectorHtml}
                    <div id="watch-providers-container">
                        ${getWatchProvidersContentHtml(watchProviders, defaultRegion)}
                    </div>
                </div>
            `;
        }
        
        // Generate HTML for watch providers content
        function getWatchProvidersContentHtml(watchProviders, region) {
            if (!watchProviders || !watchProviders[region]) {
                return '<p>No streaming information available for this region.</p>';
            }
            
            const regionData = watchProviders[region];
            let html = '';
            
            // Link to JustWatch page
            let justWatchLink = '';
            if (regionData.link) {
                justWatchLink = `
                    <div style="margin-top: 15px; font-size: 0.8rem;">
                        <a href="${regionData.link}" target="_blank" style="color: var(--secondary-color); text-decoration: none;">
                            View all options on JustWatch
                        </a>
                    </div>
                `;
            }
            
            // Helper function to get provider logo
            function getProviderLogo(provider) {
                // Special cases for specific providers
                if (provider.provider_name.toLowerCase().includes('fubo')) {
                    return 'https://images.justwatch.com/icon/207468084/s100/fubo.png';
                } else if (provider.provider_name.toLowerCase().includes('apple tv')) {
                    return 'https://images.justwatch.com/icon/190848813/s100/appletv.png';
                } else {
                    return `${IMAGE_BASE_URL}w92${provider.logo_path}`;
                }
            }
            
            // Add streaming (flatrate) providers
            if (regionData.flatrate && regionData.flatrate.length > 0) {
                // Filter out Peacock Premium Plus if present
                const filteredProviders = regionData.flatrate.filter(provider => 
                    !provider.provider_name.toLowerCase().includes('peacock premium plus'));
                
                if (filteredProviders.length > 0) {
                    html += `
                        <div class="provider-type">Stream</div>
                        <div class="watch-providers-list">
                            ${filteredProviders.map(provider => `
                                <a href="${getProviderUrl(provider)}" target="_blank" class="provider-item" title="Watch on ${provider.provider_name}">
                                    <img src="${getProviderLogo(provider)}" 
                                         alt="${provider.provider_name}" 
                                         class="provider-logo">
                                    <div class="provider-name">${provider.provider_name}</div>
                                </a>
                            `).join('')}
                        </div>
                    `;
                }
            }
            
            // Add rent providers
            if (regionData.rent && regionData.rent.length > 0) {
                const filteredProviders = regionData.rent.filter(provider => 
                    !provider.provider_name.toLowerCase().includes('peacock premium plus'));
                
                if (filteredProviders.length > 0) {
                    html += `
                        <div class="provider-type">Rent</div>
                        <div class="watch-providers-list">
                            ${filteredProviders.map(provider => `
                                <a href="${getProviderUrl(provider)}" target="_blank" class="provider-item" title="Rent on ${provider.provider_name}">
                                    <img src="${getProviderLogo(provider)}" 
                                         alt="${provider.provider_name}" 
                                         class="provider-logo">
                                    <div class="provider-name">${provider.provider_name}</div>
                                </a>
                            `).join('')}
                        </div>
                    `;
                }
            }
            
            // Add buy providers
            if (regionData.buy && regionData.buy.length > 0) {
                const filteredProviders = regionData.buy.filter(provider => 
                    !provider.provider_name.toLowerCase().includes('peacock premium plus'));
                
                if (filteredProviders.length > 0) {
                    html += `
                        <div class="provider-type">Buy</div>
                        <div class="watch-providers-list">
                            ${filteredProviders.map(provider => `
                                <a href="${getProviderUrl(provider)}" target="_blank" class="provider-item" title="Buy on ${provider.provider_name}">
                                    <img src="${getProviderLogo(provider)}" 
                                         alt="${provider.provider_name}" 
                                         class="provider-logo">
                                    <div class="provider-name">${provider.provider_name}</div>
                                </a>
                            `).join('')}
                        </div>
                    `;
                }
            }
            
            if (html === '') {
                return '<p>No streaming information available for this region.</p>';
            }
            
            return html + justWatchLink;
        }
        
        // Helper function to get provider URL
        function getProviderUrl(provider) {
            // Special case for Fubo TV - always use fubo.tv
            if (provider.provider_name.toLowerCase().includes('fubo')) {
                return "https://fubo.tv/";
            }
            
            // Maps provider IDs to their direct URLs
            const providerUrls = {
                8: "https://www.netflix.com/", // Netflix
                9: "https://www.primevideo.com/", // Amazon Prime
                337: "https://www.disneyplus.com/", // Disney+
                2: "https://www.apple.com/apple-tv-plus/", // Apple TV+
                3: "https://play.google.com/store/movies", // Google Play
                10: "https://www.amazon.com/gp/video/storefront", // Amazon Video
                15: "https://www.hulu.com/", // Hulu
                1899: "https://www.max.com/", // Max (formerly HBO Max)
                531: "https://www.paramountplus.com/", // Paramount+
                386: "https://www.peacocktv.com/", // Peacock
                11: "https://www.microsoft.com/en-us/store/movies-and-tv", // Microsoft Store
                7: "https://www.vudu.com/", // Vudu
                350: "https://www.appletv.com/", // Apple TV
                283: "https://www.crunchyroll.com/", // Crunchyroll
                192: "https://www.youtube.com/", // YouTube
                100: "https://www.showtime.com/", // Showtime
                1797: "https://pluto.tv/", // Pluto TV
                37: "https://tv.youtube.com/", // YouTube Premium
                559: "https://fubo.tv/", // FuboTV
                87: "https://www.criterionchannel.com/", // Criterion Channel
                232: "https://www.starz.com/", // STARZ
                190: "https://www.tubitv.com/", // Tubi TV
                2554: "https://www.amcplus.com/", // AMC+
                1875: "https://www.discoveryplus.com/", // Discovery+
                444: "https://www.directv.com/", // DIRECTV
                369: "https://www.pbs.org/pbs-video-app/", // PBS
                371: "https://www.sho.com/", // Showtime Now
                562: "https://www.mubi.com/" // MUBI
                // Add more providers as needed
            };

            // If we have a URL for this provider, use it, otherwise default to JustWatch
            if (providerUrls[provider.provider_id]) {
                return providerUrls[provider.provider_id];
            } else {
                // Default to JustWatch's main page as fallback
                return "https://www.justwatch.com/";
            }
        }
        
        // Helper function to get country name from region code
        function getCountryName(regionCode) {
            const countryNames = {
                'US': 'United States',
                'CA': 'Canada',
                'GB': 'United Kingdom',
                'FR': 'France',
                'DE': 'Germany',
                'AU': 'Australia',
                'ES': 'Spain',
                'IT': 'Italy',
                'JP': 'Japan',
                'BR': 'Brazil',
                'MX': 'Mexico',
                'IN': 'India',
                'KR': 'South Korea',
                'RU': 'Russia',
                'NL': 'Netherlands',
                'SE': 'Sweden'
                // Add more as needed
            };
            
            return countryNames[regionCode] || regionCode;
        }
        
        // Display cast members
        async function displayCastMembers(cast) {
            castGrid.innerHTML = '';
            
            // Sort by order and take top 10
            const mainCast = cast.sort((a, b) => a.order - b.order).slice(0, 10);
            
            for (const actor of mainCast) {
                // Create cast member card
                const castMember = document.createElement('div');
                castMember.className = 'cast-member';
                
                let photoHtml;
                if (actor.profile_path) {
                    photoHtml = `<img src="${IMAGE_BASE_URL}w185${actor.profile_path}" alt="${actor.name}" class="cast-photo">`;
                } else {
                    photoHtml = `<div class="cast-photo placeholder-image"></div>`;
                }
                
                castMember.innerHTML = `
                    <div class="cast-header-container">
                        ${photoHtml}
                        <div class="cast-info">
                            <div class="cast-name">${actor.name}</div>
                            <div class="character-name">as ${actor.character || 'Unknown'}</div>
                        </div>
                    </div>
                    <div class="known-for-container">
                        <div class="known-for-title">Known For</div>
                        <div class="known-for-list" id="known-for-${actor.id}">
                            <div class="loader-spinner" style="width: 20px; height: 20px;"></div>
                        </div>
                    </div>
                `;
                
                castGrid.appendChild(castMember);
                
                // Load actor's known for credits
                loadActorCredits(actor.id);
            }
        }
        
        // Load actor's known for credits
        async function loadActorCredits(actorId) {
            try {
                // First get the actor's profile to find their official "known for" works
                const profileResponse = await fetch(`${BASE_URL}/person/${actorId}?append_to_response=movie_credits,tv_credits`, {
                    headers: {
                        'Authorization': `Bearer ${API_KEY}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                const profileData = await profileResponse.json();
                
                // Also get combined credits for backup and verification
                const creditsResponse = await fetch(`${BASE_URL}/person/${actorId}/combined_credits`, {
                    headers: {
                        'Authorization': `Bearer ${API_KEY}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                const creditsData = await creditsResponse.json();
                
                // Merge and verify the credits
                displayKnownForCredits(actorId, profileData, creditsData.cast);
            } catch (error) {
                console.error(`Error loading credits for actor ${actorId}:`, error);
                const knownForElement = document.getElementById(`known-for-${actorId}`);
                if (knownForElement) {
                    knownForElement.innerHTML = '<p>Failed to load credits</p>';
                }
            }
        }
        
        // Display known for credits
        function displayKnownForCredits(actorId, profileData, allCredits) {
            const knownForElement = document.getElementById(`known-for-${actorId}`);
            
            if (!knownForElement) return;
            
            knownForElement.innerHTML = '';
            
            if (!allCredits || allCredits.length === 0) {
                knownForElement.innerHTML = '<p>No known credits</p>';
                return;
            }
            
            // Filter out talk shows, reality shows, game shows and similar content
            const filteredCredits = allCredits.filter(credit => {
                // Skip talk shows, late night shows, award shows, reality shows, etc.
                const title = credit.title || credit.name || '';
                const excludedShowKeywords = [
                    // Talk shows
                    'conan', 'late night', 'late show', 'tonight show', 'jimmy kimmel', 
                    'jimmy fallon', 'seth meyers', 'james corden', 'ellen', 'graham norton',
                    'colbert', 'daily show', 'award', 'oscar', 'emmy', 'golden globe',
                    'talk show', 'interview', 'behind the scenes', 'making of', 'live with',
                    // Reality/Game shows
                    'running man', 'survivor', 'big brother', 'amazing race', 'voice', 
                    'got talent', 'masked singer', 'drag race', 'bachelor', 'dancing with',
                    'american idol', 'real housewives', 'master chef', 'top chef', 'x factor',
                    'reality', 'game show', 'variety show', 'competition'
                ];
                
                // Check if it's an excluded show by title
                if (excludedShowKeywords.some(keyword => 
                    title.toLowerCase().includes(keyword))) {
                    return false;
                }
                
                // Check by genre if available - exclude talk shows, reality TV, and game shows
                const excludedGenreIds = [10767, 10764]; // Talk show and reality TV genre IDs
                if (credit.genre_ids && 
                    credit.genre_ids.some(id => excludedGenreIds.includes(id))) {
                    return false;
                }
                
                return true;
            });
            
            // Create a scoring system for credits
            const scoredCredits = filteredCredits
                .filter(credit => credit.poster_path) // Only include items with posters
                .map(credit => {
                    let score = credit.vote_count * 0.5; // Base on number of votes
                    score += credit.popularity * 10; // Popularity is important
                    
                    // Prioritize leading roles (lower order number)
                    if (credit.order !== undefined && credit.order < 3) {
                        score += 1000 - (credit.order * 200);
                    }
                    
                    // Check if character name contains "self" or is empty (likely not a major role)
                    if (credit.character && (
                        credit.character.toLowerCase().includes('self') || 
                        credit.character.trim() === '' || 
                        credit.character.toLowerCase().includes('uncredited')
                    )) {
                        score -= 500; // Lower priority for cameos/self appearances
                    }
                    
                    // Adjust for very old or very new items
                    const releaseYear = credit.release_date ? 
                        new Date(credit.release_date).getFullYear() : 
                        (credit.first_air_date ? new Date(credit.first_air_date).getFullYear() : 2000);
                    
                    // Prioritize movies from last 20 years, but give classics a boost
                    const currentYear = new Date().getFullYear();
                    if (releaseYear > currentYear - 20) {
                        score += 200; // Recent is good
                    } else if (releaseYear < 1980) {
                        // Potential classics get a boost based on vote average (quality)
                        if (credit.vote_average && credit.vote_average > 7.5) {
                            score += 400; // Classic with high rating
                        }
                    }
                    
                    // Extra penalty for documentaries where actor might be "Self"
                    if (credit.genre_ids && credit.genre_ids.includes(99)) { // Documentary genre ID
                        score -= 300;
                    }
                    
                    // Specific penalty for "The Running Man" if it somehow gets through the filters
                    if ((credit.title && credit.title.toLowerCase().includes('running man')) || 
                        (credit.name && credit.name.toLowerCase().includes('running man'))) {
                        score -= 5000; // Significant penalty to ensure it doesn't appear
                    }
                    
                    return { ...credit, score };
                })
                .sort((a, b) => b.score - a.score)
                .slice(0, 8);
            
            if (scoredCredits.length === 0) {
                knownForElement.innerHTML = '<p>No known credits with images</p>';
                return;
            }
            
            // Add verification badge to confirmed roles
            scoredCredits.forEach(credit => {
                const isMovie = credit.media_type === 'movie';
                const title = isMovie ? credit.title : credit.name;
                const releaseDate = isMovie ? credit.release_date : credit.first_air_date;
                const year = releaseDate ? new Date(releaseDate).getFullYear() : 'Unknown';
                const mediaType = isMovie ? 'movie' : 'tv';
                
                // Verify the actor's role by checking character name
                let roleInfo = '';
                if (credit.character && credit.character.trim() !== '') {
                    roleInfo = `<div class="known-for-role">as ${credit.character}</div>`;
                }
                
                // Add badge for verified roles
                let verifiedBadge = '';
                if (credit.character && !credit.character.toLowerCase().includes('uncredited')) {
                    verifiedBadge = '<span style="color: #01b4e4; font-size: 0.7rem; margin-left: 5px;">✓ Verified</span>';
                }
                
                const creditElement = document.createElement('a');
                creditElement.className = 'known-for-item';
                creditElement.href = `https://www.themoviedb.org/${mediaType}/${credit.id}`;
                creditElement.target = '_blank';
                
                creditElement.innerHTML = `
                    <img src="${IMAGE_BASE_URL}w185${credit.poster_path}" alt="${title}" class="known-for-poster">
                    <div class="known-for-info">
                        <div class="known-for-name">${title}${verifiedBadge}</div>
                        <div class="known-for-year">${year} | ${isMovie ? 'Movie' : 'TV'}</div>
                        ${roleInfo}
                    </div>
                `;
                
                knownForElement.appendChild(creditElement);
            });
        }
        
        function showLoader() {
            loader.style.display = 'block';
        }
        
        function hideLoader() {
            loader.style.display = 'none';
        }
    </script>
</body>
</html>
