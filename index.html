<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Movie Cast Explorer</title>
    <style>
        :root {
            --primary-color: #032541;
            --secondary-color: #01b4e4;
            --background-color: #f5f5f5;
            --card-background: #ffffff;
            --text-color: #333333;
            --card-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--background-color);
            color: var(--text-color);
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background-color: var(--primary-color);
            color: white;
            padding: 20px 0;
            text-align: center;
            margin-bottom: 30px;
        }
        
        h1 {
            margin: 0;
            font-size: 2.5rem;
        }
        
        .search-container {
            display: flex;
            justify-content: center;
            margin-bottom: 30px;
        }
        
        .search-box {
            display: flex;
            width: 100%;
            max-width: 600px;
        }
        
        #movie-search {
            flex-grow: 1;
            padding: 12px 16px;
            font-size: 1rem;
            border: 1px solid #ddd;
            border-radius: 4px 0 0 4px;
            outline: none;
        }
        
        button {
            background-color: var(--secondary-color);
            color: white;
            border: none;
            padding: 12px 24px;
            font-size: 1rem;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        .search-button {
            border-radius: 0 4px 4px 0;
        }
        
        button:hover {
            background-color: #018eb6;
        }
        
        #search-results {
            margin-bottom: 30px;
        }
        
        .movie-results {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
        }
        
        .movie-card {
            background-color: var(--card-background);
            border-radius: 8px;
            overflow: hidden;
            box-shadow: var(--card-shadow);
            transition: transform 0.3s;
            cursor: pointer;
        }
        
        .movie-card:hover {
            transform: translateY(-5px);
        }
        
        .movie-poster {
            width: 100%;
            height: 300px;
            object-fit: cover;
            background-color: #ddd;
        }
        
        .movie-info {
            padding: 15px;
        }
        
        .movie-title {
            font-weight: bold;
            margin-bottom: 5px;
            font-size: 1rem;
        }
        
        .movie-year {
            color: #666;
            font-size: 0.9rem;
        }
        
        #cast-container {
            display: none;
        }
        
        .cast-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .movie-details {
            display: flex;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .selected-movie-poster {
            width: 185px;
            border-radius: 8px;
            box-shadow: var(--card-shadow);
        }
        
        .selected-movie-info {
            flex: 1;
        }
        
        .selected-movie-title {
            font-size: 1.8rem;
            margin: 0 0 10px 0;
        }
        
        .selected-movie-year {
            color: #666;
            font-size: 1.1rem;
            margin-bottom: 15px;
        }
        
        .selected-movie-overview {
            line-height: 1.6;
        }
        
        .back-button {
            margin-right: 15px;
            background-color: #666;
            border-radius: 4px;
        }
        
        .cast-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
        }
        
        .cast-member {
            background-color: var(--card-background);
            border-radius: 8px;
            overflow: hidden;
            box-shadow: var(--card-shadow);
        }
        
        .cast-header-container {
            display: flex;
            gap: 15px;
            padding: 15px;
        }
        
        .cast-photo {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            object-fit: cover;
            background-color: #ddd;
        }
        
        .cast-info {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        
        .cast-name {
            font-weight: bold;
            font-size: 1.1rem;
            margin-bottom: 5px;
        }
        
        .character-name {
            color: #666;
            font-size: 0.9rem;
        }
        
        .known-for-container {
            padding: 15px;
            border-top: 1px solid #eee;
            background-color: #f9f9f9;
        }
        
        .known-for-title {
            font-weight: bold;
            margin-bottom: 10px;
            font-size: 0.9rem;
        }
        
        .known-for-list {
            display: flex;
            gap: 10px;
            overflow-x: auto;
            padding-bottom: 10px;
        }
        
        .known-for-item {
            min-width: 120px;
            border-radius: 4px;
            overflow: hidden;
            box-shadow: var(--card-shadow);
            background-color: white;
            text-decoration: none;
            color: var(--text-color);
        }
        
        .known-for-poster {
            width: 100%;
            height: 180px;
            object-fit: cover;
            background-color: #ddd;
        }
        
        .known-for-info {
            padding: 8px;
        }
        
        .known-for-name {
            font-size: 0.85rem;
            font-weight: bold;
            margin-bottom: 4px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            display: flex;
            align-items: center;
        }
        
        .known-for-year {
            font-size: 0.75rem;
            color: #666;
            margin-bottom: 2px;
        }
        
        .known-for-role {
            font-size: 0.7rem;
            color: #01b4e4;
            font-style: italic;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .attribution {
            text-align: center;
            margin-top: 50px;
            padding: 20px;
            font-size: 0.85rem;
            color: #666;
        }
        
        .tmdb-logo {
            height: 20px;
            vertical-align: middle;
            margin-left: 5px;
        }
        
        .loader {
            display: none;
            text-align: center;
            margin: 30px 0;
        }
        
        .loader-spinner {
            border: 5px solid #f3f3f3;
            border-top: 5px solid var(--secondary-color);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        @media (max-width: 768px) {
            .movie-details {
                flex-direction: column;
                align-items: center;
                text-align: center;
            }
            
            .cast-grid {
                grid-template-columns: repeat(auto-fill, minmax(100%, 1fr));
            }
        }
        
        .placeholder-image {
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: #e1e1e1;
            color: #888;
            font-size: 0.8rem;
            text-align: center;
        }
    </style>
</head>
<body>
    <header>
        <h1>Movie Cast Explorer</h1>
    </header>
    
    <div class="container">
        <div class="search-container">
            <div class="search-box">
                <input type="text" id="movie-search" placeholder="Search for a movie...">
                <button class="search-button" id="search-button">Search</button>
            </div>
        </div>
        
        <div id="search-results">
            <h2>Search Results</h2>
            <div class="movie-results" id="movie-results"></div>
        </div>
        
        <div class="loader" id="loader">
            <div class="loader-spinner"></div>
            <p>Loading...</p>
        </div>
        
        <div id="cast-container">
            <div class="movie-details" id="movie-details"></div>
            
            <div class="cast-grid" id="cast-grid"></div>
        </div>
        
        <div class="attribution">
            This product uses the TMDB API but is not endorsed or certified by TMDB.
            <img src="https://www.themoviedb.org/assets/2/v4/logos/v2/blue_short-8e7b30f73a4020692ccca9c88bafe5dcb6f8a62a4c6bc55cd9ba82bb2cd95f6c.svg" alt="TMDB Logo" class="tmdb-logo">
        </div>
    </div>
    
    <script>
        const API_KEY = 'eyJhbGciOiJIUzI1NiJ9.eyJhdWQiOiI1MjhiYzcxZTI2ODJmYzJmOGI1YjYzNGQ2ZjY3MTYyZSIsIm5iZiI6MTc0MDQ5NjE3My41NTIsInN1YiI6IjY3YmRkZDJkNzYxNzU2OGZjNjVlOWZlNCIsInNjb3BlcyI6WyJhcGlfcmVhZCJdLCJ2ZXJzaW9uIjoxfQ._ZUjD-qC3Duv8FxHAs1Psnzaw_c7e5POR9PhnOo8H8c';
        const BASE_URL = 'https://api.themoviedb.org/3';
        const IMAGE_BASE_URL = 'https://image.tmdb.org/t/p/';
        
        const searchInput = document.getElementById('movie-search');
        const searchButton = document.getElementById('search-button');
        const searchResults = document.getElementById('search-results');
        const movieResults = document.getElementById('movie-results');
        const castContainer = document.getElementById('cast-container');
        const movieDetails = document.getElementById('movie-details');
        const castGrid = document.getElementById('cast-grid');
        const loader = document.getElementById('loader');
        
        // Event listeners
        searchButton.addEventListener('click', performSearch);
        searchInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                performSearch();
            }
        });
        
        // Search for movies
        async function performSearch() {
            const query = searchInput.value.trim();
            if (!query) return;
            
            showLoader();
            
            // Reset the view to search results
            castContainer.style.display = 'none';
            searchResults.style.display = 'block';
            
            try {
                const response = await fetch(`${BASE_URL}/search/movie?query=${encodeURIComponent(query)}`, {
                    headers: {
                        'Authorization': `Bearer ${API_KEY}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                const data = await response.json();
                displayMovieResults(data.results);
            } catch (error) {
                console.error('Error searching for movies:', error);
                alert('Failed to search for movies. Please try again.');
            } finally {
                hideLoader();
            }
        }
        
        // Display movie search results
        function displayMovieResults(movies) {
            movieResults.innerHTML = '';
            
            if (movies.length === 0) {
                movieResults.innerHTML = '<p>No movies found. Try a different search term.</p>';
                return;
            }
            
            movies.slice(0, 12).forEach(movie => {
                const releaseDate = movie.release_date ? new Date(movie.release_date).getFullYear() : 'Unknown';
                
                const movieCard = document.createElement('div');
                movieCard.className = 'movie-card';
                movieCard.addEventListener('click', () => loadMovieCast(movie.id, movie));
                
                let posterHtml;
                if (movie.poster_path) {
                    posterHtml = `<img src="${IMAGE_BASE_URL}w342${movie.poster_path}" alt="${movie.title}" class="movie-poster">`;
                } else {
                    posterHtml = `<div class="movie-poster placeholder-image">No Poster Available</div>`;
                }
                
                movieCard.innerHTML = `
                    ${posterHtml}
                    <div class="movie-info">
                        <div class="movie-title">${movie.title}</div>
                        <div class="movie-year">${releaseDate}</div>
                    </div>
                `;
                
                movieResults.appendChild(movieCard);
            });
        }
        
        // Load cast for a selected movie
        async function loadMovieCast(movieId, movie) {
            showLoader();
            
            try {
                // Get movie details including cast
                const response = await fetch(`${BASE_URL}/movie/${movieId}/credits`, {
                    headers: {
                        'Authorization': `Bearer ${API_KEY}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                const data = await response.json();
                
                // Get additional movie details
                const movieDetailsResponse = await fetch(`${BASE_URL}/movie/${movieId}`, {
                    headers: {
                        'Authorization': `Bearer ${API_KEY}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                const movieDetailsData = await movieDetailsResponse.json();
                
                displayMovieDetails(movieDetailsData);
                displayCastMembers(data.cast);
                
                // Switch to cast view
                searchResults.style.display = 'none';
                castContainer.style.display = 'block';
                
                // Scroll to top
                window.scrollTo(0, 0);
            } catch (error) {
                console.error('Error loading movie cast:', error);
                alert('Failed to load movie cast. Please try again.');
            } finally {
                hideLoader();
            }
        }
        
        // Display selected movie details
        function displayMovieDetails(movie) {
            const releaseDate = movie.release_date ? new Date(movie.release_date).getFullYear() : 'Unknown';
            
            let posterHtml;
            if (movie.poster_path) {
                posterHtml = `<img src="${IMAGE_BASE_URL}w185${movie.poster_path}" alt="${movie.title}" class="selected-movie-poster">`;
            } else {
                posterHtml = `<div class="selected-movie-poster placeholder-image">No Poster Available</div>`;
            }
            
            movieDetails.innerHTML = `
                ${posterHtml}
                <div class="selected-movie-info">
                    <h3 class="selected-movie-title">${movie.title}</h3>
                    <div class="selected-movie-year">${releaseDate} | ${movie.runtime ? movie.runtime + ' min' : 'Unknown length'}</div>
                    <p class="selected-movie-overview">${movie.overview || 'No overview available.'}</p>
                </div>
            `;
        }
        
        // Display cast members
        async function displayCastMembers(cast) {
            castGrid.innerHTML = '';
            
            // Sort by order and take top 10
            const mainCast = cast.sort((a, b) => a.order - b.order).slice(0, 10);
            
            for (const actor of mainCast) {
                // Create cast member card
                const castMember = document.createElement('div');
                castMember.className = 'cast-member';
                
                let photoHtml;
                if (actor.profile_path) {
                    photoHtml = `<img src="${IMAGE_BASE_URL}w185${actor.profile_path}" alt="${actor.name}" class="cast-photo">`;
                } else {
                    photoHtml = `<div class="cast-photo placeholder-image"></div>`;
                }
                
                castMember.innerHTML = `
                    <div class="cast-header-container">
                        ${photoHtml}
                        <div class="cast-info">
                            <div class="cast-name">${actor.name}</div>
                            <div class="character-name">as ${actor.character || 'Unknown'}</div>
                        </div>
                    </div>
                    <div class="known-for-container">
                        <div class="known-for-title">Known For</div>
                        <div class="known-for-list" id="known-for-${actor.id}">
                            <div class="loader-spinner" style="width: 20px; height: 20px;"></div>
                        </div>
                    </div>
                `;
                
                castGrid.appendChild(castMember);
                
                // Load actor's known for credits
                loadActorCredits(actor.id);
            }
        }
        
        // Load actor's known for credits
        async function loadActorCredits(actorId) {
            try {
                // First get the actor's profile to find their official "known for" works
                const profileResponse = await fetch(`${BASE_URL}/person/${actorId}?append_to_response=movie_credits,tv_credits`, {
                    headers: {
                        'Authorization': `Bearer ${API_KEY}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                const profileData = await profileResponse.json();
                
                // Also get combined credits for backup and verification
                const creditsResponse = await fetch(`${BASE_URL}/person/${actorId}/combined_credits`, {
                    headers: {
                        'Authorization': `Bearer ${API_KEY}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                const creditsData = await creditsResponse.json();
                
                // Merge and verify the credits
                displayKnownForCredits(actorId, profileData, creditsData.cast);
            } catch (error) {
                console.error(`Error loading credits for actor ${actorId}:`, error);
                const knownForElement = document.getElementById(`known-for-${actorId}`);
                if (knownForElement) {
                    knownForElement.innerHTML = '<p>Failed to load credits</p>';
                }
            }
        }
        
        // Display known for credits
        function displayKnownForCredits(actorId, profileData, allCredits) {
            const knownForElement = document.getElementById(`known-for-${actorId}`);
            
            if (!knownForElement) return;
            
            knownForElement.innerHTML = '';
            
            if (!allCredits || allCredits.length === 0) {
                knownForElement.innerHTML = '<p>No known credits</p>';
                return;
            }
            
            // Filter out talk shows, reality shows, game shows and similar content
            const filteredCredits = allCredits.filter(credit => {
                // Skip talk shows, late night shows, award shows, reality shows, etc.
                const title = credit.title || credit.name || '';
                const excludedShowKeywords = [
                    // Talk shows
                    'conan', 'late night', 'late show', 'tonight show', 'jimmy kimmel', 
                    'jimmy fallon', 'seth meyers', 'james corden', 'ellen', 'graham norton',
                    'colbert', 'daily show', 'award', 'oscar', 'emmy', 'golden globe',
                    'talk show', 'interview', 'behind the scenes', 'making of', 'live with',
                    // Reality/Game shows
                    'running man', 'survivor', 'big brother', 'amazing race', 'voice', 
                    'got talent', 'masked singer', 'drag race', 'bachelor', 'dancing with',
                    'american idol', 'real housewives', 'master chef', 'top chef', 'x factor',
                    'reality', 'game show', 'variety show', 'competition'
                ];
                
                // Check if it's an excluded show by title
                if (excludedShowKeywords.some(keyword => 
                    title.toLowerCase().includes(keyword))) {
                    return false;
                }
                
                // Check by genre if available - exclude talk shows, reality TV, and game shows
                const excludedGenreIds = [10767, 10764]; // Talk show and reality TV genre IDs
                if (credit.genre_ids && 
                    credit.genre_ids.some(id => excludedGenreIds.includes(id))) {
                    return false;
                }
                
                return true;
            });
            
            // Create a scoring system for credits
            // Prioritize:
            // 1. Credits with higher vote counts (more verified by users)
            // 2. Movies over TV shows (unless TV show is very popular)
            // 3. Lead roles over supporting roles (check cast position/order)
            // 4. Recent works over very old ones (but still consider classics)
            
            const scoredCredits = filteredCredits
                .filter(credit => credit.poster_path) // Only include items with posters
                .map(credit => {
                    let score = credit.vote_count * 0.5; // Base on number of votes
                    score += credit.popularity * 10; // Popularity is important
                    
                    // Prioritize leading roles (lower order number)
                    if (credit.order !== undefined && credit.order < 3) {
                        score += 1000 - (credit.order * 200);
                    }
                    
                    // Check if character name contains "self" or is empty (likely not a major role)
                    if (credit.character && (
                        credit.character.toLowerCase().includes('self') || 
                        credit.character.trim() === '' || 
                        credit.character.toLowerCase().includes('uncredited')
                    )) {
                        score -= 500; // Lower priority for cameos/self appearances
                    }
                    
                    // Adjust for very old or very new items
                    const releaseYear = credit.release_date ? 
                        new Date(credit.release_date).getFullYear() : 
                        (credit.first_air_date ? new Date(credit.first_air_date).getFullYear() : 2000);
                    
                    // Prioritize movies from last 20 years, but give classics a boost
                    const currentYear = new Date().getFullYear();
                    if (releaseYear > currentYear - 20) {
                        score += 200; // Recent is good
                    } else if (releaseYear < 1980) {
                        // Potential classics get a boost based on vote average (quality)
                        if (credit.vote_average && credit.vote_average > 7.5) {
                            score += 400; // Classic with high rating
                        }
                    }
                    
                    // Extra penalty for documentaries where actor might be "Self"
                    if (credit.genre_ids && credit.genre_ids.includes(99)) { // Documentary genre ID
                        score -= 300;
                    }
                    
                    // Specific penalty for "The Running Man" if it somehow gets through the filters
                    if ((credit.title && credit.title.toLowerCase().includes('running man')) || 
                        (credit.name && credit.name.toLowerCase().includes('running man'))) {
                        score -= 5000; // Significant penalty to ensure it doesn't appear
                    }
                    
                    return { ...credit, score };
                })
                .sort((a, b) => b.score - a.score)
                .slice(0, 5);
            
            if (scoredCredits.length === 0) {
                knownForElement.innerHTML = '<p>No known credits with images</p>';
                return;
            }
            
            // Add verification badge to confirmed roles
            scoredCredits.forEach(credit => {
                const isMovie = credit.media_type === 'movie';
                const title = isMovie ? credit.title : credit.name;
                const releaseDate = isMovie ? credit.release_date : credit.first_air_date;
                const year = releaseDate ? new Date(releaseDate).getFullYear() : 'Unknown';
                const mediaType = isMovie ? 'movie' : 'tv';
                
                // Verify the actor's role by checking character name
                let roleInfo = '';
                if (credit.character && credit.character.trim() !== '') {
                    roleInfo = `<div class="known-for-role">as ${credit.character}</div>`;
                }
                
                // Add badge for verified roles
                let verifiedBadge = '';
                if (credit.character && !credit.character.toLowerCase().includes('uncredited')) {
                    verifiedBadge = '<span style="color: #01b4e4; font-size: 0.7rem; margin-left: 5px;">✓ Verified</span>';
                }
                
                const creditElement = document.createElement('a');
                creditElement.className = 'known-for-item';
                creditElement.href = `https://www.themoviedb.org/${mediaType}/${credit.id}`;
                creditElement.target = '_blank';
                
                creditElement.innerHTML = `
                    <img src="${IMAGE_BASE_URL}w185${credit.poster_path}" alt="${title}" class="known-for-poster">
                    <div class="known-for-info">
                        <div class="known-for-name">${title}${verifiedBadge}</div>
                        <div class="known-for-year">${year} | ${isMovie ? 'Movie' : 'TV'}</div>
                        ${roleInfo}
                    </div>
                `;
                
                knownForElement.appendChild(creditElement);
            });
        }
        
        function showLoader() {
            loader.style.display = 'block';
        }
        
        function hideLoader() {
            loader.style.display = 'none';
        }
    </script>
</body>
</html>
